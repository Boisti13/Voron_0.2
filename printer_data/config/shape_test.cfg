####################################################################################################

# ---------------------------------------------------------
# Quick Input Shaper Calibration (Bambu-style)
# Runs before each print (adds ~1–2 min overhead)
# ---------------------------------------------------------

[gcode_macro QUICK_NOISE_CHECK]
description: 2–4s accelerometer sanity check (no motion)
gcode:
  M117 Checking accel noise...
  MEASURE_AXES_NOISE
  M117 Noise check done

[gcode_macro MOVE_TO_RESO_POINT]
gcode:
  {% set p = printer.configfile.settings.resonance_tester.probe_points[0] %}
  {% set x = p[0]|float %}{% set y = p[1]|float %}{% set z = p[2]|float %}
  G0 X{x} Y{y} F6000
  G0 Z{z} F1200


[gcode_macro QUICK_SHAPER_FAST]
description: Quick shaper recal on one axis near the corner test point (AXIS=X|Y)
variable_axis: "X"
gcode:
  {% set axis = (params.AXIS|default(printer["gcode_macro QUICK_SHAPER_FAST"].axis)|string).upper() %}
  {% if axis not in ["X","Y"] %}{% set axis = "X" %}{% endif %}

  M117 Quick shaper {axis}
  G28
  MOVE_TO_RESO_POINT
  TEST_RESONANCES AXIS={axis}
  SHAPER_CALIBRATE
  M117 Shaper updated ({axis})
  # SAVE_CONFIG
